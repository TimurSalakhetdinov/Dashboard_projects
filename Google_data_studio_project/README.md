# Создание дашборда продаж с возвратами

**Цель проекта:** 

У команды продукта новая квартальная задача: работа с возвратами. Чтобы вы могли вывести аналитику возвратов в дашборды, команда IT выкатила в релизе новое поле в таблице с заказами (инвойсами) -- тип заказа (type). 

Теперь там есть не только приход (income), но и возвраты (refund). При этом возвратные инвойсы – это не статус старого заказа, а новые заказы, которые дважды в неделю добавляет вручную отдел продаж и теперь в дашбордах если просто выводить сумму по выручке без фильтра по типу заказа, то каждый заказ, по которому был проведен возврат, дублируется возвратным инвойсом и у каждого инвойса свой invoice_id.
 
**Исходные данные:**

Данные о продажах сохраняются в базе данных Google Cloud. Мы имеем доступ для подключения к базе через BigQuery.

Документация к БД - <https://docs.google.com/spreadsheets/d/1P4z7XRBUaK_1okHLudHi9YKmmThAqlOOMkGW9PYrDZg/edit?usp=share_link>

**Задача проекта:**

Cобрать дашборд, который покажет продактам динамику и текущую ситуацию по возвратам в контексте общей ситуации по продуктам. 

Сумма возврата не всегда равна сумме платежа, так как в первичных оплатах мы удерживаем комиссию платежных систем, а в продлениях чаще всего возвращаем полную сумму.

**SQL запрос**

```sql
WITH Income_Refund AS (
 SELECT
   product,
   paid_date,
   country,
   payment_system,
   SUM(CASE WHEN type = 'income' THEN paid_amount ELSE 0 END) AS total_income,
   SUM(CASE WHEN type = 'refund' THEN paid_amount ELSE 0 END) AS total_refund
 FROM `takeclass-test.test.ff_sales_test`
 GROUP BY product, paid_date, country, payment_system
)
SELECT
 product,
 paid_date,
 country,
 payment_system,
 total_income,
 total_refund,
 total_income - total_refund AS net_income
FROM Income_Refund;

**Проект выполнен в Google Data Studio:**

Ссылка на проект - <https://lookerstudio.google.com/reporting/793631d5-0da9-4246-9f09-fd7fcc2d0b2c>

**Компоненты:**

Фильтры: по валюте, продукту и датам платежей.
Суммы возратов, выручки и чистого дохода за период.
Линейный график временных рядов: отображает динамику доходов и возвратов с течением времени.
Pie chart: показывает соотношение сумм возмещения по продуктам.
Гистограмма: исследует эффективность различных платежных систем с точки зрения возвратов и доходов.
Географическая тепловая карта: показаны страны, из которых происходит наибольшее количество возвратов.
Таблица: отображает такие сведения, как выручка, возвраты и чистый доход по продуктам.

**Логика панели управления**

Как посмотреть данные:

- Выбрать валюту платежа из фильтра.
- Сравнить тенденции доходов и возмещений, чтобы обнаружить аномалии.
- Определить продукты, которые имеют высокое соотношение возврата к доходу требуют изучения.

Ответы на вопросы:

- Каковы тенденции доходов и возмещений?
- Какие продукты имеют наибольшее количество возвратов по отношению к доходу?
- Каково географическое распределение возмещений?

Ограничения данных:

Возвраты добавляются вручную два раза в неделю, что может приводить к потенциальным задержкам в аналитике в реальном времени.

**Запрос на улучшение данных:**

Для дальнейшего улучшения анализа необходимо попросить ИТ-команду добавить:

- return_processing_date: дата фактической обработки возврата.
- return_initiated_by: указывает, кто инициировал возврат средств: клиент или отдел продаж.

Используя дополнительные данные, можно будет эффективно анализировать динамику как доходов, так и возвратов, что важно для понимания финансового состояния продукта.